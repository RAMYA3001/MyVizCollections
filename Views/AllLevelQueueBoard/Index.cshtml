@*﻿@model PagedList.IPagedList<MyVizCollections.Models.AllLevelQueueBoard>*@
@*@using PagedList.Mvc*@


@{
    ViewBag.Title = "QueueBoard - Projects in progress";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string currentFilter = ViewBag.CurrentFilter;
    string currentSort = ViewBag.CurrentSort;
    string Cdate = ViewBag.Fdate;
    string Edate = ViewBag.Ldate;
    string s1 = ViewBag.s1;
    string s2 = ViewBag.s2;
    var currentYear = DateTime.Now.Year;
    var currentDate = DateTime.Now.ToString("yyyy-MM-dd");
}


<style>
    .container {
        padding-right: 5px;
        /* padding-left: 15px; */
        margin-right: auto;
        margin-left: 25px;
        width: auto;
    }

    img {
        border-radius: 8px;
    }

    #myprogressBar {
        width: 1%;
        height: 20px;
        background-color: #4CAF50;
        text-align: center;
        line-height: 32px;
        color: black;
    }

    #datepicker {
        font-size: 14px; /* Adjust as needed */
        line-height: 1.8; /* Adjust as needed */
    }



    #overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        z-index: 999;
    }

    #qaPopup {
        position: fixed;
        top: 50%;
        left: 50%;
        width: 34%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        z-index: 1000;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

        #qaPopup .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

            #qaPopup .popup-header h3 {
                color: darkblue;
                text-align: center;
                flex-grow: 1;
            }

    #closePopup {
        background: none;
        border: none;
        padding: 10px 20px;
        color: #000;
        cursor: pointer;
    }

    #saveQAResult, #closePopup {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
    }

        #saveQAResult:disabled, #closePopup:disabled {
            background-color: grey;
            cursor: not-allowed;
        }

    #saveQAResult, #closePopup {
        margin: 10px;
    }

    #buttons-container {
        text-align: center;
    }

    /* Styling for the additional comments section */
    #additionalComments {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        resize: vertical;
    }

        #additionalComments textarea {
            width: 100%;
            padding: 10px;
            resize: vertical;
        }




    .popup-container {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 480px;
        background: #fdfdfd;
        border-radius: 8px;
        box-shadow: 0 0 20px rgba(0,0,0,0.3);
        padding: 20px;
        z-index: 1000;
    }

    .popup-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #ccc;
        margin-bottom: 10px;
    }

        .popup-header h3 {
            margin: 0;
            font-size: 20px;
            color: #2c3e50;
        }

    .close-btn {
        font-size: 22px;
        color: #999;
        cursor: pointer;
    }

        .close-btn:hover {
            color: #333;
        }

    .instructions {
        font-size: 13px;
        margin-bottom: 15px;
        color: #444;
    }

    .form-row {
        margin-bottom: 12px;
        font-size: 14px;
        color: #333;
    }

        .form-row select,
        .form-row textarea {
            width: 18%;
            padding: 6px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-top: 5px;
        }

    .help-text {
        font-size: 12px;
        color: #777;
        margin-top: 10px;
    }

    .popup-actions {
        text-align: center;
        margin-top: 20px;
    }

        .popup-actions button {
            background-color: #337ab7;
            border: none;
            color: white;
            padding: 8px 18px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
        }

            .popup-actions button:hover {
                background-color: #2e6da4;
            }
</style>
@* Label shown only to non-admin *@

@if (Session["username"] != null && Session["username"].ToString().ToLower() != "viewreport")
{

    <label for="pid1" style=" margin-left: 956px;  color: red;margin-bottom: 12px;">
        Compare
    </label>

}
<div style="padding: 10px; display: flex; align-items: center; flex-wrap: wrap; width: 100%; gap: 1px; margin-bottom: 20px;margin-left:-111px">

    <!-- ✅ Year Dropdown -->
    @*<label for="yearDropdown" style="margin-right: 5px;">Year:</label>
        <select id="yearDropdown" style="margin-right: 10px;width:55px; height: 30px;">
            @for (int year = 2016; year <= 2035; year++)
            {
                <option value="@year" @(year == currentYear ? "selected" : "")>@year</option>
            }
        </select>*@
    <label for="yearDropdown" style="margin-right: 5px;">Year:</label>
    <select id="yearDropdown" style="margin-right: 10px;width:55px; height:30px;">
        @for (int year = 2023; year <= currentYear; year++)
        {
            <option value="@year" @(year == currentYear ? "selected" : "")>@year</option>
        }
    </select>

    <!-- ✅ From Date -->
    <label for="fromDate" style="margin-right: 1px;">From:</label>
    <input type="date" id="fromDate" value="@currentDate" max="@currentDate" style="margin-right: 3px;width:103px; height: 30px;" />

    <!-- ✅ To Date -->
    <label for="toDate" style="margin-right: 5px;">To:</label>
    <input type="date" id="toDate" value="@currentDate" max="@currentDate" style="margin-right: 10px; width: 103px; height: 30px;" />

    <!-- ✅ Submit Button -->
    <button type="submit" class="btn btn-primary" id="btnSubmit1" style="height: 30px;">Submit</button>








    <select class="form-control" id="dropdownSelect3" style="width: 104px; margin-right: 10px " title="Search Key">
        <option value="tso.ProjectID" @(ViewBag.s1 == "tso.ProjectID" ? "selected" : "")>ProjectID</option>
        <option value="tso.Wstatus" @(ViewBag.s1 == "tso.Wstatus" ? "selected" : "")>Status</option>

        @*<option value="tso.UserID" @(ViewBag.s1 == "tso.UserID" ? "selected" : "")>TSO</option>
            <option value="WStatusCount" @(ViewBag.s1 == "WStatusCount" ? "selected" : "")>St# >=</option>
            <option value="pt.IorEorMS" @(ViewBag.s1 == "pt.IorEorMS" ? "selected" : "")>Type</option>
            <option value="pt.ProjectCategory" @(ViewBag.s1 == "pt.ProjectCategory" ? "selected" : "")>Category</option>
            <option value="fb.TSOInput" @(ViewBag.s1 == "fb.TSOInput" ? "selected" : "")>Feedback</option>
            <option value="tso.ColourChoicebyTSO" @(ViewBag.s1 == "tso.ColourChoicebyTSO" ? "selected" : "")>CC</option>
            <option value="tso.Priority" @(ViewBag.s1 == "tso.Priority" ? "selected" : "")>Priority</option>
            <option value="tso.NexGenDealer" @(ViewBag.s1 == "tso.NexGenDealer" ? "selected" : "")>NxtGen</option>*@

    </select>

    <input type="text" name="q" class="search-text form-control" placeholder="Search..." title="Search relevant details in the grid" data-toggle="tooltip" id="searchtxt" style="width: 86px; margin-right: 2px; margin-left: -8px; ">

    <button type="submit" class="btn btn-primary" id="btnSubmit" style="height: 30px;">Search</button>
    <button type="submit" class="btn btn-primary" id="btnClear" style="height: 30px; margin: 2px;">Clear</button>
</div>
</div>
@* Form shown only to non-admin *@
@if (Session["username"] != null && Session["username"].ToString().ToLower() != "viewreport")
{
    <div class="form-group" style="border: 2px solid #337ab7; padding: 41px 14px; display: flex; justify-content: flex-start; margin-bottom: 3px; margin-top: -119px; margin-left:812px; width: 567px; height: 1px;">
        <label for="pid1" style=" margin-top: 11px;">
            Project1:
        </label>
        <input type="text" name="q" class="search-text form-control" placeholder="ProjectID1" title="Enter ProjectID to Search" data-toggle="tooltip" id="searchtxt1">
        <select class="form-control" id="dropdownSelect1">
            <option value="SI">SI</option>
            <option value="Image1">Source1</option>
            <option value="Image2">Source2</option>
            <option value="Image3">Source3</option>
            <option value="PRI">PRI</option>
        </select>
        <label for="pid2" style="margin-left: 9px; margin-top: 11px;">
            Project2:
        </label>
        <input type="text" name="q" class="search-text form-control" placeholder="ProjectID2" title="Enter ProjectID to Search" data-toggle="tooltip" id="searchtxt2">
        <select class="form-control" id="dropdownSelect2">
            <option value="PRI">PRI</option>
            <option value="SI">SI</option>
            <option value="Image1">Source1</option>
            <option value="Image2">Source2</option>
            <option value="Image3">Source3</option>
        </select>
        <button type="submit" class="btn btn-primary" title="Compare two different image in one single screen" id="btnCompare" style="height: 30px; margin: 2px;">Match</button>
    </div>

}
    <!-- Background overlay -->
    <div id="overlay" style="display:none;"></div>

    <div id="qaPopup" class="popup-container" style="display:none;">
        <div class="popup-header">

            <h3>ActOn05</h3>
            <span class="close-btn" id="closePopup">&times;</span>
        </div>

        <p class="instructions">
            Download the Source from SILink or the PRI from PRILink and PRITest to verify before proceeding
        </p>

        <div class="form-row">
            <label for="projectID">Project ID:</label>

            <input type="text" id="projectID" value="" required readonly />
            <br />
            <strong>Project Name:</strong> <span id="projectName"></span>

        </div>
        <div id="pseIDRow" class="form-row">
            <strong id="pseLabel">Referred by (PSE):</strong> <span id="pseID"></span>
        </div>


        <div id="pseRemarksRow" class="form-row">
            <strong>Comment:</strong> <span id="pseRemarks"></span>
        </div>


        <div id="cpeFields" class="form-row">
            <strong>Referred by (CPE):</strong> <span id="cpeiID"></span><br>
            <strong>Comment:</strong> <span id="cpiRemarks"></span>
        </div>

        <div class="form-row">
            <strong>Action:</strong>
            <select id="qaResult">
                <option value="Pass">Pass</option>
                <option value="Fail">Fail</option>
            </select>
        </div>

        @*<div class="form-row">
                <strong>Action to be taken:</strong><br>
                <textarea id="additionalComments" rows="3" placeholder="Enter QC comments here"></textarea>
            </div>*@
        <div class="form-row">
            <label style="display: block; font-weight: bold;">
                Action to be taken: <span style="font-size: 12px; color: red;">(Enter at least 5 characters)</span>
            </label>
            <textarea id="additionalComments" rows="3" placeholder="Enter QC comments here"></textarea>
            <span id="commentError" style="color: red; display: none;"></span>
        </div>



        <p class="help-text">
            Help: If referred by PSE, status can be either 10 - Force assigned to same PSE or 90 - Rejected.<br>
            If referred by CPE, status can be either 15 - Rework by same PSE or 45 - for CPE to do CPI.
        </p>

        <div class="popup-actions">
            <button id="saveQAResult" disabled>Save</button>
            <button id="closePopup1">Close</button>
        </div>
    </div>



    @*<a href="@Url.Action("ResolutionCheck", "AllLevelQueueBoard")" target="_blank">
            <input type="button" class="btn btn-primary"  value="Resolution" style="margin-left:6px" />
        </a>*@
    </div>
    <div class="panel panel-primary list-panel" id="list-panel" style="width:115%;margin-top:12px;margin-left:9px;">
        <div class="panel-heading list-panel-heading">
            <h1 class="panel-title list-panel-title">DashBoard  <span style="float:right;margin-right:310px;">Total Records: @ViewBag.RowCount</span></h1>
        </div>
        <div id="progress" class="modal">
            <div class="center" style="margin-left: 535px; margin-top: 300px;">

                <img src="~/images/loader4.gif" style="width:80px !important" />
            </div>
        </div>


        <div class="container body-content" style="width: 1600px;"></div>

        <div class="panel-body" style="width: 100%; overflow: auto;">
            <table id="assets-data-table" class="table table-striped table-bordered" style="width: 100%; position: relative;">
                <thead>
                    <tr>
                        <th>ProjectID</th>
                        <th>PSE Name</th>
                        <th>CPE Name</th>
                        @*<th style="padding: 9px 33px;">ProjectName</th>*@

                        <th style="padding: 9px 25px;">RegdOn</th>


                        <th data-toggle="tooltip" title="MyViz insylog details">RegdBy</th>

                        <th data-toggle="tooltip" title="WStatus log details"> St</th>

                        <th data-toggle="tooltip" title="No.of instance WStatuslog">St# </th>
                        <th style="padding: 9px 28px;"> StDate</th>

                        <th>EmailSent</th>
                        <th data-toggle="tooltip" title="SelectedImageLink">SILink</th>
                        <th>PRILink</th>
                        <th>PRITest</th>
                        <th data-toggle="tooltip" title="SoftCopy Album 1">SCA1</th>
                        <th data-toggle="tooltip" title="SoftCopy Album 2">SCA2 </th>
                        <th data-toggle="tooltip" title="SoftCopy Album 3">SCA3 </th>
                        <th>Source1</th>
                        <th>Source2</th>
                        <th>Source3</th>

                        <th data-toggle="tooltip" title="SelectedImageOption">SIOpt</th>
                        <th>Preview</th>
                        <th>Site</th>
                        <th>Customer</th>
                        @if (Session["username"] != null && Session["username"].ToString() != "viewreport")
                        {
                            <th>FeedBack</th>
                            <th data-toggle="tooltip" title="ColourChoicebyTSO">CC</th>
                            <th>DuplicateOf</th>
                            <th data-toggle="tooltip" title="Priority">PRI</th>
                            <th data-toggle="tooltip" title="NxtGen">NG</th>
                            <th>Type</th>
                            <th>Category</th>
                        }
                        <th>
                            @if (Session["username"] != null && Session["username"].ToString() == "ActOn05")
                            {
                                @:ActOn05
                            }
                        </th>

                    </tr>
                </thead>

                <tbody>
                    @foreach (var asset in Model)
                    {
                        <tr>
                            <td style="text-align-last:left">
                                <a data-value="@asset.ProjectID" href="~/AllLevelQueueBoard/myModal?ProjectID=@asset.ProjectID" data-id="@asset.ProjectID" title="Click to view Project details, to update status" data-toggle="tooltip" target="_blank">@asset.ProjectID</a>
                            </td>
                            <td>@asset.PSEName</td>
                            <td>@asset.CPEName</td>

                            <!-- Other table cells -->
                            @*<td>@asset.ProjectName</td>*@

                            @*<td>@String.Format("{0:ddd, dd MMM hh:mm tt}", asset.RegdOn)</td>*@
                            <td>@String.Format("{0:dd-MMM-yyyy hh:mm tt}", asset.RegdOn)</td>

                            @*<td>@(Convert.ToDateTime(asset.RegdOn).ToString("dd/MM/yy"))</td>*@
                            @*<td>@asset.RegdBy</td>*@

                            <td style="text-align-last:left">
                                <a data-value="@asset.ProjectID" href="~/AllLevelQueueBoard/Myvizinsylog?ProjectID=@asset.ProjectID" data-id="@asset.ProjectID" title="Click to view Myvizinsylog details" data-toggle="tooltip" target="_blank"> @asset.RegdBy</a>
                            </td>


                            <td style="text-align-last:left">
                                <a data-value="@asset.ProjectID" href="~/AllLevelQueueBoard/Statuslog?ProjectID=@asset.ProjectID" data-id="@asset.ProjectID" title="Click to view Status log details" data-toggle="tooltip" target="_blank"> @asset.FinalStatus</a>
                            </td>




                            <td style="text-align-last:left">
                                <a data-value="@asset.ProjectID" href="~/AllLevelQueueBoard/SCAQALog?ProjectID=@asset.ProjectID" data-id="@asset.ProjectID" title="Click to view SCAQA details" data-toggle="tooltip" target="_blank"> @asset.WStsCount</a>
                            </td>



                            @*<td>@asset.WStsCount</td>*@

                            <td>@string.Format("{0:dd-MMM-yyyy hh:mm tt}", asset.FinalStatusDt)</td>
                            <td>
                                @if (asset.FinalStatus == "50" && asset.EmailStatus == "S")
                                {
                                    <span style="color:red">Yes</span>
                                }
                                else if (asset.FinalStatus == "60" && asset.EmailStatus == "S")
                                {
                                    @:Yes
                                }
                                else if (asset.FinalStatus == "60" && string.IsNullOrWhiteSpace(asset.EmailStatus))
                                {
                                    <span style="color:red">No</span>
                                }
                                else
                                {
                                    @asset.EmailStatus
                                }
                            </td>
                            @*<td>@(Convert.ToDateTime(asset.FinalStatusDt).ToString("dd/MM/yy"))</td>*@

                            <td>
                                @if (!string.IsNullOrEmpty(asset.SelectedImageLink))
                                {
                                    <a href="@Url.Action("DisplayImage", "AllLevelQueueBoard", new { ProjectID = asset.ProjectID, linkType = "Source", sourcefile = asset.SelectedImageLink })" target="_blank" title="Click to open SelectedImageLink" data-toggle="tooltip">@asset.ProjectID</a>
                                }
                                else
                                {

                                }
                            </td>

                            <td>
                                @if (!string.IsNullOrEmpty(asset.PRILink))
                                {
                                    <a href="@Url.Action("DisplayImage", "AllLevelQueueBoard", new { ProjectID = asset.ProjectID, linkType = "PRI" })" target="_blank" title="Click to open PRILink" data-toggle="tooltip">@asset.ProjectID</a>
                                }
                                else
                                {

                                }
                            </td>

                            <td>
                                @if (!string.IsNullOrEmpty(asset.PRITest))
                                {
                                    <a href="@Url.Action("DisplayImage", "AllLevelQueueBoard", new { ProjectID = asset.ProjectID, linkType = "PRI_Test" })" target="_blank" title="Click to open PRITest" data-toggle="tooltip">@asset.ProjectID</a>
                                }
                                else
                                {

                                }
                            </td>
                            <td>
                                @if (!string.IsNullOrEmpty(asset.SCA1))
                                {
                                    <a href="@Url.Action("DisplayImage", "AllLevelQueueBoard", new { ProjectID = asset.ProjectID, linkType = "PDF1" })" target="_blank" title="Click to open SCA1Link" data-toggle="tooltip">@asset.ProjectID</a>
                                }
                                else
                                {

                                }
                            </td>
                            <td>
                                @if (!string.IsNullOrEmpty(asset.SCA2))
                                {
                                    <a href="@Url.Action("DisplayImage", "AllLevelQueueBoard", new { ProjectID = asset.ProjectID, linkType = "PDF2" })" target="_blank" title="Click to open SCA2Link" data-toggle="tooltip">@asset.ProjectID</a>
                                }
                                else
                                {

                                }
                            </td>
                            <td>
                                @if (!string.IsNullOrEmpty(asset.SCA3))
                                {
                                    <a href="@Url.Action("DisplayImage", "AllLevelQueueBoard", new { ProjectID = asset.ProjectID, linkType = "PDF3" })" target="_blank" title="Click to open SCA3Link" data-toggle="tooltip">@asset.ProjectID</a>
                                }
                                else
                                {

                                }
                            </td>

                            <td>
                                @if (!string.IsNullOrEmpty(asset.ImageFileName1))
                                {
                                    <a href="@Url.Action("DisplayImage", "AllLevelQueueBoard", new { ProjectID = asset.ProjectID, linkType = "img1", sourcefile = asset.ImageFileName1 })" target="_blank" title="Click to open Imagefile1" data-toggle="tooltip">@asset.ProjectID</a>
                                }
                                else
                                {

                                }
                            </td>

                            <td>
                                @if (!string.IsNullOrEmpty(asset.ImageFileName2))
                                {
                                    <a href="@Url.Action("DisplayImage", "AllLevelQueueBoard", new { ProjectID = asset.ProjectID, linkType = "img2", sourcefile = asset.ImageFileName2 })" target="_blank" title="Click to open Imagefile2" data-toggle="tooltip">@asset.ProjectID</a>
                                }
                                else
                                {

                                }
                            </td>

                            <td>
                                @if (!string.IsNullOrEmpty(asset.ImageFileName3))
                                {
                                    <a href="@Url.Action("DisplayImage", "AllLevelQueueBoard", new { ProjectID = asset.ProjectID, linkType = "img3", sourcefile = asset.ImageFileName3 })" target="_blank" title="Click to open Imagefile3" data-toggle="tooltip">@asset.ProjectID</a>
                                }
                                else
                                {

                                }
                            </td>

                            @*<td>
            <a href="@Url.Action("Appliedcolour", "AllLevelQueueBoard")" target="_blank" title="Click to open Imagefile3" data-toggle="tooltip">@asset.Appliedcolour</a>

        </td>*@

                            <td>
                                @asset.SIOption
                            </td>
                            <td>
                                <button id="previewButton" class="btn btn-primary btn-sm" onclick="launchPreview(@asset.ProjectID)">Preview</button>
                            </td>


                            @*<td>@asset.EmailStatus</td>
        <td>@asset.EMailValues</td>*@




                            <td>@asset.Site</td>
                            <td>@asset.Customer</td>
                            @if (Session["username"] != null && Session["username"].ToString() != "viewreport")
                            {
                                <td>@asset.FeedBack</td>
                                <td>@asset.CC</td>
                                <td>@asset.DuplicateOf</td>
                                <td>@asset.Priority</td>
                                <td>@asset.NexGenDealer</td>
                                <td>@asset.Type</td>
                                <td>@asset.Category</td>
                            }
                            <td>
                                @if (Session["username"] != null && Session["username"].ToString() == "ActOn05")
                                {
                                    <button type="submit" class="btn btn-primary" id="showPopup" data-id="@asset.ProjectID" style="height: 30px; margin: 2px;" Readonly>ActOn05</button>
                                }
                            </td>
                        </tr>



                    }
                </tbody>
            </table>

            <div class="text-center">
                @*Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) of @Model.PageCount*@
                @*@Html.PagedListPager(Model, page => Url.Action("Index", new { page, Fdate = ViewBag.Fdate, s1 = ViewBag.s1, s2 = ViewBag.s2 }))*@
            </div>
            <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
            <script src="/path/to/datatables.min.js"></script>
            <link href="/Content/PagedList.css" rel="stylesheet" type="text/css" />
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" />
            <link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css" />
            <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.2.2/css/buttons.dataTables.min.css" />
            <link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" />
            <script>

                //from,to date


                document.addEventListener("DOMContentLoaded", function () {
                    const yearDropdown = document.getElementById("yearDropdown");
                    const fromDate = document.getElementById("fromDate");
                    const toDate = document.getElementById("toDate");
                    const today = new Date();



                    function updateDateLimits() {
                        const selectedYear = parseInt(yearDropdown.value);

                        // Limit min and max date to selected year
                        const minDate = `${selectedYear}-01-01`;
                        const maxDate = selectedYear === today.getFullYear()
                            ? today.toISOString().split("T")[0]
                            : `${selectedYear}-12-31`;

                        fromDate.min = minDate;
                        fromDate.max = maxDate;
                        toDate.min = minDate;
                        toDate.max = maxDate;

                        // Reset values if outside allowed range
                        if (fromDate.value < minDate || fromDate.value > maxDate) {
                            fromDate.value = minDate;
                        }
                        if (toDate.value < minDate || toDate.value > maxDate) {
                            toDate.value = maxDate;
                        }
                    }

                    // Update when year changes
                    yearDropdown.addEventListener("change", updateDateLimits);

                    // ✅ Submit button reloads with same selected values
                    document.getElementById("btnSubmit1").addEventListener("click", function () {
                        const selectedYear = yearDropdown.value;
                        const fromVal = fromDate.value;
                        const toVal = toDate.value;

                        const url = `?Year=${selectedYear}&Fdate=${fromVal}&Ldate=${toVal}`;
                        window.location.href = url; // reloads same page with query params
                    });

                    // If page reloaded, restore selected values from query params
                    const params = new URLSearchParams(window.location.search);
                    if (params.has("Year")) {
                        yearDropdown.value = params.get("Year");
                    }
                    if (params.has("Fdate")) {
                        fromDate.value = params.get("Fdate");
                    }
                    if (params.has("Ldate")) {
                        toDate.value = params.get("Ldate");
                    }

                    updateDateLimits(); // initial setup
                });





                        $(function () {



             

                            function toggleSubmitButton() {
                                const val = $("#dropdownSelect3").val();
                                if (val === "tso.Wstatus") {
                                    $("#btnSubmit1").hide();  // Hide when Status selected
                                } else {
                                    $("#btnSubmit1").show();  // Show otherwise
                                }
                            }

                            // 🔹 Run every time dropdown changes
                            $("#dropdownSelect3").change(toggleSubmitButton);

                            // 🔹 Also run once on page load (after Search reload)
                            toggleSubmitButton();






//$("#dropdownSelect3").val('@ViewBag.s1');
             $("#searchtxt").val('@ViewBag.s2');
             $("#searchtxt1").val('@ViewBag.s2');
             $("#searchtxt2").val('@ViewBag.s2');

         });





            // Replicate the value of #searchtxt to #searchtxt1 and #searchtxt2
            $("#searchtxt").keyup(function () {
                // Check if the dropdown value is "ProjectID"
                if ($("#dropdownSelect3").val() === "tso.ProjectID") {
                    var searchTextValue = $(this).val();
                    $("#searchtxt1").val(searchTextValue);
                    $("#searchtxt2").val(searchTextValue);
                }
            });



$("#btnSubmit").click(function () {
    $("#progress").show();
    
    var selectedDropdown = $("#dropdownSelect3").val(); // s1
    var searchText = $("#searchtxt").val(); // s2
    var fromDate = $("#fromDate").val(); // Fdate
    var toDate = $("#toDate").val();   // Tdate

    var url = "@Url.Action("Index", "AllLevelQueueBoard")" + "?s1=" + selectedDropdown + "&s2=" + searchText;
    
        if (selectedDropdown === "tso.Wstatus") {
            url += "&Fdate=" + fromDate + "&Ldate=" + toDate;
     
    }

    // Redirect to the generated URL
    window.location.href = url;
    
});




            /*Click event for the Clear button*/
            $("#btnClear").click(function () {

                /* Clear the search input*/
                $("#searchtxt").val("");
                $("#searchtxt1").val("");
                $("#searchtxt2").val("");
               var url = "@Url.Action("Index", "AllLevelQueueBoard")";
                window.location.href = url;
                $('#dropdownSelect3').val('tso.ProjectID'); // Reset to ProjectID
                // Show Submit again
                $("#btnSubmit1").show();
               });




                function launchPreview(projectId) {
             // Construct the URL for the LaunchPreview action
             var url = "@Url.Action("LaunchPreview", "AllLevelQueueBoard")" + "?Id=" + projectId;

             // Open the URL in a new tab
             window.open(url, '_blank');
            }

            $(document).ready(function () {
                $("#btnCompare").click(function () {
                    var ProjectID1 = $("#searchtxt1").val();
                    var ProjectID2 = $("#searchtxt2").val();
                    var sourceType1 = $("#dropdownSelect1").val();
                    var sourceType2 = $("#dropdownSelect2").val();

                    // Check if both project IDs are entered
                    if (ProjectID1 && ProjectID2) {
                        $.ajax({
                            type: "GET",
                            @*url: "@Url.Action("AllLevelQueueBoard", "Getsourceid")",*@
                            url: "@Url.Action("Getsourceid","AllLevelQueueBoard")",

                            data: { ProjectID1: ProjectID1, ProjectID2: ProjectID2, Type1: sourceType1, Type2: sourceType2 },
                            success: function (data) {
                               /*   alert('test1');*/
                                if (data.length < 1) {
                                    alert("Kindly Check the ProjectID...");
                                } else {
           /* alert('test2');*/
                                    var p1 = data[0].ProjectID1;
                                    var p2 = data[0].ProjectID2;
                                   /* alert(p1);*/
                                    var imageUrl1, imageUrl2;

                                   /* alert('test4');*/
                                    //alert(sourceType1);
                                       @*<div>Project ID: @ViewBag.pid</div>*@
                                    if (sourceType1 == "SI") {
                                    imageUrl1 = "https://colourmyspace.co.in/MyVizCollections/AllLevelQueueBoard/DisplayImage?ProjectID=" + ProjectID1 + "&linkType=Source&sourcefile=" + p1;
                                } else if (sourceType1 === "Image1") {
                                    imageUrl1 = "https://colourmyspace.co.in/MyVizCollections/AllLevelQueueBoard/DisplayImage?ProjectID=" + ProjectID1 + "&linkType=img1&sourcefile=" + p1;
                                } else if (sourceType1 === "Image2") {
                                    imageUrl1 = "https://colourmyspace.co.in/MyVizCollections/AllLevelQueueBoard/DisplayImage?ProjectID=" + ProjectID1 + "&linkType=img2&sourcefile=" + p1;
                                } else if (sourceType1 === "Image3") {
                                    imageUrl1 = "https://colourmyspace.co.in/MyVizCollections/AllLevelQueueBoard/DisplayImage?ProjectID=" + ProjectID1 + "&linkType=img3&sourcefile=" + p1;

                                } else if (sourceType1 === "PRI") {
                                    imageUrl1 = "https://colourmyspace.co.in/MyVizCollections/AllLevelQueueBoard/DisplayImage?ProjectID=" + ProjectID1 + "&linkType=PRI";
                                }


                                    if (sourceType2 === "SI") {
                                        imageUrl2 = "https://colourmyspace.co.in/MyVizCollections/AllLevelQueueBoard/DisplayImage?ProjectID=" + ProjectID2 + "&linkType=Source&sourcefile=" + p2;
                                    } else if (sourceType2 === "Image1") {
                                        imageUrl2 = "https://colourmyspace.co.in/MyVizCollections/AllLevelQueueBoard/DisplayImage?ProjectID=" + ProjectID2 + "&linkType=img1&sourcefile=" + p2;
                                    } else if (sourceType2 === "Image2") {
                                        imageUrl2 = "https://colourmyspace.co.in/MyVizCollections/AllLevelQueueBoard/DisplayImage?ProjectID=" + ProjectID2 + "&linkType=img2&sourcefile=" + p2;
                                    } else if (sourceType2 === "Image3") {
                                        imageUrl2 = "https://colourmyspace.co.in/MyVizCollections/AllLevelQueueBoard/DisplayImage?ProjectID=" + ProjectID2 + "&linkType=img3&sourcefile=" + p2;


                                    }
                                    else if (sourceType2 === "PRI") {
                                        imageUrl2 = "https://colourmyspace.co.in/MyVizCollections/AllLevelQueueBoard/DisplayImage?ProjectID=" + ProjectID2 + "&linkType=PRI";
                                    }

                                    // Open a new window to display the images
                                    var newWindow = window.open();

                                    newWindow.document.write("<html><head><style>html, body { margin: 0; height: 100%; overflow: hidden; } body { display: flex; justify-content: center; align-items: center; } .image-container { display: flex; flex-direction: column; justify-content: center; align-items: center; width: 50%; height: 100%; box-sizing: border-box; text-align: center; padding: 0 5px; } .project-id { display: block; margin-bottom: 5px; font-weight: bold;font-family:arial; }.source-type{font-weight: bold;font-family:arial;} img { max-width: 100%; max-height: 100%; }</style></head><body><div class='image-container'><span class='project-id'>Project ID: " + ProjectID1 + "</span><span class='source-type'> " + sourceType1 + "</span><img src='" + imageUrl1 + "' alt='Image 1' style='height: 90%;'></div><div class='image-container'><span class='project-id'>Project ID: " + ProjectID2 + "</span><span class='source-type'> " + sourceType2 + "</span><img src='" + imageUrl2 + "' alt='Image 2' style='height: 90%;'></div></body></html>");


                                }
                            },
                            error: function (xhr, status, error) {
                                alert("An error occurred while fetching project data. Kindly Check the Project IDs.");
                            }
                        });
                    } else {
                        alert("Please enter both Project IDs.");
                    }
                });
            });


            $("#progress").hide();

            // Enable Save Button when mandatory fields are filled




            // Use event delegation to handle clicks on all SCAQA buttons
$('#assets-data-table').on('click', '#showPopup', function () {
    var projectID = $(this).data('id'); // Get the ProjectID from the clicked button
    var ProjectName = $(this).data('id1');
    // Set the ProjectID in the popup input field
    $('#projectID').val(projectID);
    $('#ProjectName').val(ProjectName);


$.ajax({
    url: '@Url.Action("GetSCAQAData", "AllLevelQueueBoard")',
    type: 'GET',
    data: { projectID: projectID },
    success: function (response) {
        console.log("QA response:", response); // <--- Check this in browser console
        if (response.success) {
            $('#projectID').text(response.data.ProjectID);
            $('#pseID').text(response.data.WhoistheL6PSE);
            $('#cpeiID').text(response.data.CPEID);
            $('#pseRemarks').text(response.data.PSERemarks);
            $('#cpiRemarks').text(response.data.CPERemarks);
            $('#projectName').text(response.data.ProjectName);


            // Set popup heading based on whether CPEID is null or not
            if (!response.data.CPEID || response.data.CPEID === "null" || response.data.CPEID.trim() === "") {
                $('#qaPopup h3').html(
                    '<div style="text-align: center;">' +
                    '<div>Image Quality Referral</div>' +
                    '<div>Act_On_05 - For Source Image from PSE</div>' +
                    '</div>'
                );

                // Hide CPI fields
                $('#cpeiID').closest('div').hide();
                $('#cpiRemarks').closest('div').hide();

                // Show PSE fields
                $('#pseID').closest('div').show();
                $('#pseRemarks').closest('div').show();


                $('#qaResult').empty().append(
                    $('<option>', { value: 'Pass', text: '10' }),
                    $('<option>', { value: 'Fail', text: '90' })
                );




            } else {

                $('#qaPopup h3').html(
                    '<div style="text-align: center;">' +
                    '<div>Image Quality Referral</div>' +
                    '<div>Act_On_05 for PRI from CPE</div>' +
                    '</div>'
                );



                // Show CPI fields
                $('#cpeiID').closest('div').show();
                $('#cpiRemarks').closest('div').show();
                // Update PSE label and value
                $('#pseLabel').text('PSE Name:');
                $('#pseID').text(response.data.WhoistheL6PSE);
                $('#pseID').closest('div').show();





                // Hide PSE fields
                $('#pseRemarks').closest('div').hide();




                $('#qaResult').empty().append(
                    $('<option>', { value: 'Pass', text: '45' }),
                    $('<option>', { value: 'Fail', text: '15' })
                );



            }





            $('#overlay').show();
            $('#qaPopup').show();
        } else {
            alert(response.message);
        }


    },
    error: function () {
        alert('Error retrieving QA data.');
    }
});




    // Show the overlay and the popup form
    $('#overlay').show();
    $('#qaPopup').show();
});

// Close popup and hide overlay
$('#closePopup').on('click', function () {
    console.log('Close button clicked');
    var url = "@Url.Action("Index", "AllLevelQueueBoard")";
    window.location.href = url; // Redirect to the index page
    $('#qaPopup').hide();
    $('#overlay').hide();
    $('#projectID').val('');  // Clear ProjectID field
    $('#qaResult').val('Pass');
    const checkboxes = $('#qaComments input[type="checkbox"]');
    checkboxes.prop('checked', false);
    $('#additionalComments').val('');
    $('#selectedComments').val('');
    resetPopupFields();
});

// Populate selected comments when checkboxes are checked
$('#qaComments input[type="checkbox"]').on('change', function () {
    const selectedComments = [];
    $('#qaComments input[type="checkbox"]:checked').each(function () {
        selectedComments.push($(this).val());
    });

    // Set the selected comments (even though it's hidden, it's being sent to the server)
    $('#selectedComments').val(selectedComments.join(', '));
    checkMandatoryFields();
});


           $(document).ready(function () {
    $('#closePopup1').click(function () {
        var url = "@Url.Action("Index", "AllLevelQueueBoard")";
        window.location.href = url;
    });
});






// Save QA Result
            $('#saveQAResult').on('click', function () {
                if (!confirm('Are you sure the details are correct?')) {
                    return; // If user cancels, don't proceed
                }
    $("#progress").show();
    const projectID = $('#projectID').val().trim();
    const qaResult = $('#qaResult').val();

    const additionalComments = $('#additionalComments').val().trim();



    $.ajax({
        url: '@Url.Action("Qualitycheck", "AllLevelQueueBoard")',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({ projectID: projectID, result: qaResult, comments: additionalComments }),
        success: function (data) {
            if (data.success) {
                alert('Act_On_05 Completed!');
                resetPopupFields();
                $('#qaPopup').hide();
                $('#overlay').hide();
                location.reload();
            } else {
                alert(`Error: ${data.message}`);
                resetPopupFields();
            }
        },

        error: function (xhr, status, error) {
            console.error('Error:', error);
            alert('An error occurred while saving QC Check.');
        }
    });
});

// Input validation for Save button
document.getElementById('projectID').addEventListener('input', checkMandatoryFields);
document.getElementById('qaResult').addEventListener('change', checkMandatoryFields);
document.getElementById('additionalComments').addEventListener('input', checkMandatoryFields);
$('#qaComments input[type="checkbox"]').on('change', checkMandatoryFields);

// Reset popup fields
function resetPopupFields() {
    $('#projectID').val('');
    $('#qaResult').val('Pass');
    $('#selectedComments').val('');
    $('#additionalComments').val('');
    $('#qaComments input[type="checkbox"]').prop('checked', false);
}

// Input validation for Save button
function checkMandatoryFields() {
    const projectID = $('#projectID').val().trim();
    const qaResult = $('#qaResult').val();
    const selectedComments = $('#selectedComments').val().trim();
    const additionalComments = $('#additionalComments').val().trim();

    // Enable the Save button only if ProjectID, QA Result, and at least one comment field are filled
    $('#saveQAResult').prop('disabled', !(projectID && qaResult && (selectedComments || additionalComments)));
}



            function checkMandatoryFields() {
                const projectID = $('#projectID').val().trim();
                const qaResult = $('#qaResult').val();

                // Enable Save button only if ProjectID and QA Result are selected
                if (projectID && qaResult) {
                    $('#saveQAResult').prop('disabled', false); // Enable button
                } else {
                    $('#saveQAResult').prop('disabled', true); // Disable button
                }
            }

            // Ensure checkMandatoryFields runs on input changes
            $('#projectID, #qaResult, #additionalComments').on('input change', checkMandatoryFields);
            $('#qaComments input[type="checkbox"]').on('change', checkMandatoryFields);

            // Run once when popup opens (to check if button should be enabled immediately)
            $(document).ready(function () {
                checkMandatoryFields();
            });






            function checkMandatoryFields() {
                const projectID = $('#projectID').val().trim();
                const qaResult = $('#qaResult').val();
                const additionalComments = $('#additionalComments').val().trim();

                const isCommentValid = additionalComments.length >= 5;

                if (!isCommentValid) {
                    $('#commentError').show();
                } else {
                    $('#commentError').hide();
                }

                const enable = projectID && qaResult && isCommentValid;
                $('#saveQAResult').prop('disabled', !enable);
            }



            </script>
        </div>
    </div>