﻿@model PagedList.IPagedList<MyVizCollections.Models.AllLevelQueueBoard>
@using PagedList.Mvc


@{
    ViewBag.Title = "QueueBoard - Projects in progress";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string currentFilter = ViewBag.CurrentFilter;
    string currentSort = ViewBag.CurrentSort;
    string Cdate = ViewBag.Fdate;
    string s1 = ViewBag.s1;
    string s2 = ViewBag.s2;
}

<style>
    .container {
        padding-right: 5px;
        /* padding-left: 15px; */
        margin-right: auto;
        margin-left: 25px;
        width: auto;
    }

    img {
        border-radius: 8px;
    }

    #myprogressBar {
        width: 1%;
        height: 20px;
        background-color: #4CAF50;
        text-align: center;
        line-height: 32px;
        color: black;
    }

    #datepicker {
        font-size: 14px; /* Adjust as needed */
        line-height: 1.8; /* Adjust as needed */
    }



    #overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        z-index: 999;
    }

    #qaPopup {
        position: fixed;
        top: 50%;
        left: 50%;
        width: 34%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        z-index: 1000;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

        #qaPopup .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

            #qaPopup .popup-header h3 {
                color: darkblue;
                text-align: center;
                flex-grow: 1;
            }

    #closePopup {
        background: none;
        border: none;
        padding: 10px 20px;
        color: #000;
        cursor: pointer;
    }

    #saveQAResult, #closePopup {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
    }

        #saveQAResult:disabled, #closePopup:disabled {
            background-color: grey;
            cursor: not-allowed;
        }

    #saveQAResult, #closePopup {
        margin: 10px;
    }

    #buttons-container {
        text-align: center;
    }

    /* Styling for the additional comments section */
    #additionalComments {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        resize: vertical;
    }

        #additionalComments textarea {
            width: 100%;
            padding: 10px;
            resize: vertical;
        }




    .popup-container {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 480px;
        background: #fdfdfd;
        border-radius: 8px;
        box-shadow: 0 0 20px rgba(0,0,0,0.3);
        padding: 20px;
        z-index: 1000;
    }

    .popup-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #ccc;
        margin-bottom: 10px;
    }

        .popup-header h3 {
            margin: 0;
            font-size: 20px;
            color: #2c3e50;
        }

    .close-btn {
        font-size: 22px;
        color: #999;
        cursor: pointer;
    }

        .close-btn:hover {
            color: #333;
        }

    .instructions {
        font-size: 13px;
        margin-bottom: 15px;
        color: #444;
    }

    .form-row {
        margin-bottom: 12px;
        font-size: 14px;
        color: #333;
    }

        .form-row select,
        .form-row textarea {
            width: 18%;
            padding: 6px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-top: 5px;
        }

    .help-text {
        font-size: 12px;
        color: #777;
        margin-top: 10px;
    }

    .popup-actions {
        text-align: center;
        margin-top: 20px;
    }

        .popup-actions button {
            background-color: #337ab7;
            border: none;
            color: white;
            padding: 8px 18px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
        }

            .popup-actions button:hover {
                background-color: #2e6da4;
            }
</style>
@* Label shown only to non-admin *@


<div style=" padding: 10px 10px; display: flex; align-items: center; width: 49%; margin-bottom: 24px;margin-left:-98px;">
  

    <select class="form-control" id="dropdownSelect3" style="width: 104px; margin-right: 10px " title="Search Key">
        <option value="tso.ProjectID" @(ViewBag.s1 == "tso.ProjectID" ? "selected" : "")>ProjectID</option>
        <option value="tso.Wstatus" @(ViewBag.s1 == "tso.Wstatus" ? "selected" : "")>Status</option>
      
    </select>

    <input type="text" name="q" class="search-text form-control" placeholder="Search..." title="Search relevant details in the grid" data-toggle="tooltip" id="searchtxt" style="width: 121px; margin-right: 2px; margin-left: -8px; ">

    <button type="submit" class="btn btn-primary" id="btnSubmit" style="height: 30px;">Search</button>
    <button type="submit" class="btn btn-primary" id="btnClear" style="height: 30px; margin: 2px;">Clear</button>
</div>

   

    


    @*<a href="@Url.Action("ResolutionCheck", "AllLevelQueueBoard")" target="_blank">
            <input type="button" class="btn btn-primary"  value="Resolution" style="margin-left:6px" />
        </a>*@
    </div>
    <div class="panel panel-primary list-panel" id="list-panel" style="width:90%;margin-top:12px;margin-left:9px;">
        <div class="panel-heading list-panel-heading">
            <h1 class="panel-title list-panel-title">DashBoard</h1>
        </div>
        <div id="progress" class="modal">
            <div class="center" style="margin-left: 535px; margin-top: 300px;">

                <img src="~/images/loader4.gif" style="width:80px !important" />
            </div>
        </div>


        <div class="container body-content" style="width: 1600px;"></div>

        <div class="panel-body" style="width: 100%; overflow: auto;">

            <table id="assets-data-table" class="table table-striped table-bordered" style="width: 100%; position: relative;">
                <thead>
                    <tr>
                        <th>ProjectID</th>
                      
                            <th style=" width: 120px; ">Current Status</th>
                            @*<th>Current Status Date</th>*@
                            <th>PSE Name</th>
                            <th>CPE Name</th>
                            <th>Submitted on</th>
                            <th>Delivery on</th>
                            <th>Remaining TAT hours</th>
                            @*<th>EmailStatus </th>
            <th>
                EMailValues
            </th>*@

                    </tr>
                </thead>

                <tbody>
                    @foreach (var asset in Model)
                    {
                        <tr>
                            <td style="text-align-last:left">
                                <a data-value="@asset.ProjectID" href="~/AllLevelQueueBoard/myModal?ProjectID=@asset.ProjectID" data-id="@asset.ProjectID" title="Click to view Project details, to update status" data-toggle="tooltip" target="_blank">@asset.ProjectID</a>
                            </td>


                          
                                <td style="text-align-last:left">
                                    <a data-value="@asset.ProjectID" href="~/AllLevelQueueBoard/Statuslog?ProjectID=@asset.ProjectID" data-id="@asset.ProjectID" title="Click to view Status log details" data-toggle="tooltip" target="_blank"> @asset.FinalStatus</a>
                                </td>
                                @*<td>@string.Format("{0:dd-MMM-yyyy hh:mm tt}", asset.FinalStatusDt)</td>*@
                                <td>@asset.PSEName</td>
                                <td>@asset.CPEName</td>
                                <td>@String.Format("{0:dd-MMM-yyyy hh:mm tt}", asset.RegdOn)</td>

                                <td>
                                    @{
                                        DateTime? deliveryOn = asset.RegdOn?.AddHours(24);
                                    }
                                    @(deliveryOn.HasValue ? String.Format("{0:dd-MMM-yyyy hh:mm tt}", deliveryOn.Value) : "N/A")
                                </td>
                                <td>
                                    @{
                                        if (deliveryOn.HasValue)
                                        {
                                            int finalStatusCode;
                                            bool parseSuccess = int.TryParse(asset.FinalStatus, out finalStatusCode);

                                            double remainingTATHours;

                                            // Use FinalStatusDt only if status is 60 and FinalStatusDt exists
                                            if (parseSuccess && finalStatusCode == 60 && asset.FinalStatusDt.HasValue)
                                            {
                                                remainingTATHours = (deliveryOn.Value - asset.FinalStatusDt.Value).TotalHours;
                                            }
                                            else
                                            {
                                                remainingTATHours = (deliveryOn.Value - DateTime.Now).TotalHours;
                                            }

                                            int hours = (int)remainingTATHours;
                                            int minutes = (int)Math.Round(Math.Abs((remainingTATHours - hours) * 60));

                                            if (minutes == 60)
                                            {
                                                if (remainingTATHours >= 0)
                                                {
                                                    hours += 1;
                                                }
                                                else
                                                {
                                                    hours -= 1;
                                                }
                                                minutes = 0;
                                            }

                                            string sign = remainingTATHours < 0 ? "-" : "";
                                            string formattedTime = $"{sign}{Math.Abs(hours)}.{minutes:D2} Hrs";

                                            @formattedTime
                                        }
                                        else
                                        {
                                            @("N/A")
                                        }
                                        }
                                </td>











                                @*<td>@asset.EmailStatus</td>
                                    <td>@asset.EMailValues</td>*@
                            




                        </tr>



                                        }
                </tbody>
            </table>

            <div class="text-center">
                Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) of @Model.PageCount
                @Html.PagedListPager(Model, page => Url.Action("Index", new { page, Fdate = ViewBag.Fdate, s1 = ViewBag.s1, s2 = ViewBag.s2 }))
            </div>
            <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
            <script src="/path/to/datatables.min.js"></script>
            <link href="/Content/PagedList.css" rel="stylesheet" type="text/css" />
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" />
            <link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css" />
            <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.2.2/css/buttons.dataTables.min.css" />
            <link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" />
            <script>


            $(document).ready(function () {
                // Assuming you have a date in ViewBag named Fdate
                debugger;
                var fDateFromViewBag = '@ViewBag.Fdate';
                var date = @Cdate;
                var parsedDate = new Date(fDateFromViewBag);
                @*document.getElementById("datepicker").value = @Cdate;*@
               /*var selectedDate = "((DateTime)ViewBag.Fdate).ToString("yyyy-MM-dd")";*/
                document.getElementById("datepicker").valueAsDate = parsedDate;
            });

            $(function () {


                //$('#dropdownSelect3').change(function () {
                //    const selectedValue1 = $(this).val(); // Get the selected value
                //    console.log("Selected value1:", selectedValue1);


                //});
                $('#dropdownSelect3').change(function () {
                    const selectedValue1 = $(this).val(); // Get the selected value
                    console.log("Selected value1:", selectedValue1);

                    // Check if the selected value is "WStatusCount"
                    if (selectedValue1 === "WStatusCount") {
                        $("#btnSubmit1").hide(); // Hide the button
                    } else {
                        $("#btnSubmit1").show(); // Show the button for other values
                    }
                });



               // $("#dropdownSelect3").val('tso.ProjectID');
                //$('#dropdownSelect3').trigger('change');    //
                //$("#dropdownSelect3").val('@ViewBag.s1');
                 $("#searchtxt").val('@ViewBag.s2');
                 $("#searchtxt1").val('@ViewBag.s2');
                 $("#searchtxt2").val('@ViewBag.s2');

             });




            // Replicate the value of #searchtxt to #searchtxt1 and #searchtxt2
            $("#searchtxt").keyup(function () {
                // Check if the dropdown value is "ProjectID"
                if ($("#dropdownSelect3").val() === "tso.ProjectID") {
                    var searchTextValue = $(this).val();
                    $("#searchtxt1").val(searchTextValue);
                    $("#searchtxt2").val(searchTextValue);
                }
            });





              $("#btnSubmit").click(function () {
    $("#progress").show();

    var selectedDropdown = $("#dropdownSelect3").val(); // s1
    var searchText = $("#searchtxt").val(); // s2
    var selectedDate = $("#datepicker").val(); // Fdate

    var url = "@Url.Action("Index", "Tatreport")" + "?s1=" + selectedDropdown + "&s2=" + searchText;

    if (selectedDropdown === "WStatusCount") {
        url += "&Fdate=" + selectedDate; // Only add Fdate if dropdown is WStatusCount
    //    $("#btnSubmit1").hide(); // Hide the button when the condition is met
    //} else {
    //    $("#btnSubmit1").show(); // Show the button if the condition is not met
    }

    window.location.href = url;
});







   $("#btnSubmit1").click(function () {
       var curdate1 = $("#datepicker").val();
       /*window.location.href = '/AllLevelQueueBoard/Index/?page=null&Fdate=' + curdate1;*/
       var url = "@Url.Action("Index", "AllLevelQueueBoard")" + "?Fdate=" + curdate1;
       window.location.href = url;

   });



            /*Click event for the Clear button*/
            $("#btnClear").click(function () {

                /* Clear the search input*/
                $("#searchtxt").val("");
                $("#searchtxt1").val("");
                $("#searchtxt2").val("");
               var url = "@Url.Action("Index", "Tatreport")";
                window.location.href = url;
                $('#dropdownSelect3').val('tso.ProjectID'); // Reset to ProjectID
               });




             


            </script>
        </div>
    </div>
